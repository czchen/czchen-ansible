---

-   name: Create directories for config files
    file:
        dest: '{{ item.dest }}'
        owner: root
        group: root
        mode: '{{ item.mode | default("0755") }}'
        state: directory

    with_items:
        -   dest: /etc/sudoers.d
        -   dest: /etc/sysctl.d
        -   dest: /etc/udev/rules.d
        -   dest: /etc/apt/sources.list.d
        -   dest: /etc/modprobe.d

-   name: Setup config files
    copy:
        dest: '{{ item.dest }}'
        owner: root
        group: root
        mode: '{{ item.mode | default("0644") }}'
        content: '{{ item.content }}'

    with_items:
    -   dest: /etc/sudoers.d/czchen
        mode: '0400'
        content: |
            # This file is managed by Ansible. DO NOT EDIT.

            Defaults umask = 0022
            Defaults umask_override

    -   dest: /etc/sysctl.d/czchen.conf
        content: |
            # This file is managed by Ansible. DO NOT EDIT.

            kernel.sysrq = 1

    -   dest: /etc/udev/rules.d/99-czchen.rules
        content: |
            # This file is managed by Ansible. DO NOT EDIT.

            SUBSYSTEM=="usb", ATTR{idVendor}=="18d1", TAG+="uaccess"

    -   dest: /etc/modprobe.d/99-czchen.conf
        content: |
            # This file is managed by Ansible. DO NOT EDIT.

            options iwlwifi power_save=n
            options iwldvm power_scheme=1

            options iwlwifi 11n_disable=1

    -   dest: /etc/udev/hwdb.d/99-czchen.hwdb
        content: |
            # This file is managed by Ansible. DO NOT EDIT.

            # https://forums.puri.sm/t/keyboard-layout-unable-to-recognize-pipe/2022/10
            evdev:atkbd:dmi:bvn*:bvr*:bd*:svnPurism:pnLibrem13v2*
             KEYBOARD_KEY_56=backslash

-   name: Enable i386
    lineinfile:
        name: /var/lib/dpkg/arch
        line: 'i386'
