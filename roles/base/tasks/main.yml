---

-   file:
        dest: '{{ item.dest }}'
        owner: root
        group: root
        mode: '{{ item.mode | default("0755") }}'
        state: directory

    with_items:
        -   dest: /etc/sudoers.d
        -   dest: /etc/sysctl.d
        -   dest: /etc/udev/rules.d
        -   dest: /etc/apt/sources.list.d

-   copy:
        dest: '{{ item.dest }}'
        owner: root
        group: root
        mode: '{{ item.mode | default("0644") }}'
        content: '{{ item.content }}'

    with_items:
    -   dest: /etc/sudoers.d/umask
        mode: '0400'
        content: |
            # This file is managed by Ansible. DO NOT EDIT.

            Defaults umask = 0022
            Defaults umask_override

    -   dest: /etc/sysctl.d/sysrq.conf
        content: |
            # This file is managed by Ansible. DO NOT EDIT.

            kernel.sysrq = 1

    -   dest: /etc/udev/rules.d/99-android.rules
        content: |
            # This file is managed by Ansible. DO NOT EDIT.

            SUBSYSTEM=="usb", ATTR{idVendor}=="18d1", TAG+="uaccess"

# FIXME: use apt_repository when it supports multiple lines and filename
-   copy:
        dest: /etc/apt/sources.list
        content: |
            # This file is managed by Ansible. DO NOT EDIT.

            {% for distribution in debian.distribution %}
            deb {{ debian.repository }} {{ distribution }} {{ debian.suite }}
            deb-src {{ debian.repository }} {{ distribution }} {{ debian.suite }}
            {% endfor %}

            {% for distribution in debian.distribution if distribution != "stable" %}
            deb {{ debian.debug_repository }} {{ distribution }}-debug {{ debian.suite }}
            {% endfor %}

    register: apt_repository

-   apt:
        update_cache: yes
    when: apt_repository.get('src') != None

-   apt:
        name: '{{ item.name }}'
        state: '{{ item.state | default("present") }}'
        purge: yes

    with_items:
        -   name: apt-transport-https
        -   name: asciinema
        -   name: fonts-noto
        -   name: fonts-noto-cjk
        -   name: gnupg2
        -   name: goobook
        -   name: gufw
        -   name: keychain
        -   name: lsb-release
        -   name: msmtp
        -   name: mutt
        -   name: needrestart
        -   name: ntp
        -   name: p7zip-full
        -   name: pass
        -   name: scdaemon
        -   name: signing-party
        -   name: snapd
        -   name: sudo
        -   name: tmux
        -   name: tree
        -   name: vim-gtk # For system clipboard
        -   name: yadm
        -   name: zplug
        -   name: zsh
